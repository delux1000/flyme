<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect to My Custom RPC</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; background: #f5f5f5; }
        .rpc-url { background: #e0e0e0; padding: 10px; border-radius: 5px; word-break: break-all; }
        button { background: #3b99fc; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 20px; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #status, #result { margin-top: 20px; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
        #status { background: #fff3cd; display: none; }
        #result { background: #d4edda; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üöÄ Connect to My Custom RPC</h1>
    <p>Your RPC endpoint:</p>
    <!-- IMPORTANT: Replace this URL with your actual cloudflared tunnel URL -->
    <div class="rpc-url" id="rpcUrl">https://vegetation-workplace-experienced-illustrations.trycloudflare.com</div>

    <button id="connectBtn">Connect Wallet</button>
    <div id="status"></div>
    <div id="result"></div>

    <!-- Ethers and WalletConnect v2 Ethereum Provider -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.0/dist/index.umd.js"></script>
    <script>
        (function() {
            const rpcUrl = document.getElementById('rpcUrl').innerText;
            const projectId = "cd1a5ec0393767579e1f364ffc41597d";
            const connectBtn = document.getElementById('connectBtn');
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');

            // Check if EthereumProvider loaded
            if (typeof window.EthereumProvider === 'undefined') {
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '‚ùå WalletConnect library failed to load. Please check your internet connection or try again later.';
                statusDiv.classList.add('error');
                connectBtn.disabled = true;
            } else {
                connectBtn.addEventListener('click', async () => {
                    statusDiv.style.display = 'block';
                    statusDiv.innerText = 'Connecting...';
                    statusDiv.classList.remove('error');
                    resultDiv.innerText = '';

                    try {
                        // Initialize WalletConnect provider
                        const provider = await window.EthereumProvider.init({
                            projectId,
                            chains: [1],
                            showQrModal: true,
                            rpcMap: {
                                1: rpcUrl
                            },
                            methods: ['eth_sendTransaction', 'eth_sign'],
                            optionalMethods: ['eth_accounts']
                        });

                        // Wrap with ethers
                        const ethersProvider = new ethers.providers.Web3Provider(provider);
                        const signer = ethersProvider.getSigner();
                        const address = await signer.getAddress();
                        const balance = await ethersProvider.getBalance(address);

                        statusDiv.style.display = 'none';
                        resultDiv.innerText = `‚úÖ Connected: ${address}\nüí∞ ETH Balance: ${ethers.utils.formatEther(balance)} ETH`;
                    } catch (err) {
                        statusDiv.innerText = `‚ùå Error: ${err.message}`;
                        console.error(err);
                    }
                });
            }
        })();
    </script>
</body>
</html>
